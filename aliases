# This script is sourced AFTER shell RC scripts (bashrc / zshrc)
# Unlike profile, which is sourced before.
# This means that these aliases will overwrite any defined 
# by oh-my-zsh, oh-my-bash, AND any defined in bashrc / zshrc.

# Note: this file may also be loaded by the profile script
# If the shell is not bash or zsh. This is likely sh in such as case.
# Thus, MAINTAIN POSIX SHELL COMPATABILITY in this file!

alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
if [ "$(uname -o)" = "Msys" ]; then
    alias open=msys2_open.sh 
    trash(){
        if [ $# -lt 1 ]; then
            echo "$0 item1 [item2 [item3 ...]]"
        else
            for f in "$@"; do
                recycler.exe "$(cygpath -w "$f")"
            done
        fi
    }
elif [ "$(uname -o)" != "Darwin" ]; then
    alias open='xdg-open'
    alias trash='gio trash'
fi
if type "wslpath" > /dev/null 2>&1; then
    # Use inside WSL to open a file in the WINDOWS program not the LINUX program for that file type
    openwin(){
        target=$(wslpath -w "$1")
        cmd.exe /c start "" "$target" > /dev/null 2>&1
    }
fi
if [ "$(uname -o)" = "Msys" ]; then
    # In MSYS2 sometimes we need to launch without the environment changes made by MSYS2
    # Note that the ORIGINAL_ variables are set by MSYS2 not by this profile script
    winlaunch(){
        # In subshell so unset won't impact caller
        (
            unset HOME
            unset MSYS2_PATH_TYPE
            unset MSYSTEM
            unset MSYSTEM_PREFIX
            unset MSYSTEM_CARCH
            unset MSYSTEM_CHOST
            unset PROMPT
            unset PS1
            export PATH="$ORIGINAL_PATH"
            export TMP="$ORIGINAL_TMP"
            export TEMP="$ORIGINAL_TEMP"
            unset ORIGINAL_PATH
            unset ORIGINAL_TMP
            unset ORIGINAL_TEMP
            "$@"
        )
    }

    # Workaround for tmux bug:
    #     https://github.com/microsoft/terminal/issues/5132#issuecomment-1009022843
    #     https://github.com/alacritty/alacritty/issues/1687#issuecomment-1282482768
    # This seems to not always be needed. Mostly an issue when attaching to existing tmux
    # that was started either from mintty or remote SSH session
    # Later trying to attach from windows terminal will break things
    tmux(){
        # ORIG_TERM="$TERM"
        # ORIG_TERM="$ORIG_TERM" script -q -O /dev/null -c "tmux ${@}"
        script -q -O /dev/null -c "tmux ${@}"
    }

    create_wlalias(){
        if type $1 > /dev/null 2>&1; then
            alias $(basename "$1")="winlaunch \"$(which $1)\""
        fi
    }

    # The following windows commands are known to need winlaunch
    create_wlalias /c/Windows/System32/cmd  # Windows cmd shell
    create_wlalias powershell               # Windows powershell
    create_wlalias pwsh                     # Powershell core
    create_wlalias ucrt64                   # MSYS2 launcher from scoop
    create_wlalias mingw64                  # MSYS2 launcher from scoop
    create_wlalias mingw32                  # MSYS2 launcher from scoop
    create_wlalias clang64                  # MSYS2 launcher from scoop
    create_wlalias clang32                  # MSYS2 launcher from scoop
    create_wlalias clangarm64               # MSYS2 launcher from scoop
    create_wlalias msys2                    # MSYS2 launcher from scoop
fi

# Pickup changes to SSH agent when attaching to tmux from new login
# This does nothing on windows. SSH_AUTH_SOCK not used on windows
fixssh(){
    if [ "$(uname -o)" != "Msys" ]; then
        eval `tmux showenv -s SSH_AUTH_SOCK`
        eval `tmux showenv -s SSH_AGENT_PID`
    fi
}
